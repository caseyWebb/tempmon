<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>tempmon</title>
</head>

<body>
  <canvas id="graph" height="100%"></canvas>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"
    integrity="sha512-vBmx0N/uQOXznm/Nbkp7h0P1RfLSj0HQrFSzV8m7rOGyj30fYAOKHYvCNez+yM8IrfnW0TCodDEjRqf6fodf/Q=="
    crossorigin="anonymous"></script>
  <script>
    const ctx = document.getElementById('graph').getContext('2d');

    fetch('data').then((res) => res.json()).then((data) => {
      window.data = data
      const datasets = data.map(([unixTime, temps]) => {
        const date = new Date(unixTime)
        return Object.keys(temps).map((sensorName) => {
          const temp = temps[sensorName]
          return {
            label: sensorName,
            point: {
              x: date,
              y: temps[sensorName]
            }
          }
        })
      }).reduce((accum, points) => {
        points.forEach(({ label, point }, i) => {
          if (!accum[i]) accum[i] = { label, data: [] }
          accum[i].data.push(point)
        })
        return accum
      }, [])

      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          datasets
        },
        options: {
          scales: {
            xAxes: [{
              type: 'time',
              time: {
                unit: 'hour'
              }
            }]
          }
        }
      })
    })
  </script>
</body>

</html>